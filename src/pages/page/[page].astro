---
import { type Blog, getBlogs } from "@/libs/microcms/blog";
import type { GetStaticPathsOptions } from "astro";
import BlogListLayout from "@/layouts/BlogListLayout.astro";
import Pagination from "@/features/Pagination/Pagination.astro";
import { BlogList } from "@/features/Blog/List/BlogList";
import { BlogListSortByCategoryButton } from "@/features/Blog/List/BlogListSortByCategoryButton";

type Props = {
  page: {
    data: Blog[];
    currentPage: number;
    lastPage: number;
    size: number;
    total: number;
    url: { current: string; next?: string; prev?: string };
  };
};

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const res = await getBlogs();
  const posts = res.contents;

  return paginate(posts, {
    pageSize: 10,
  });
}

const { page } = Astro.props;

const allPosts = page.data as Blog[];

const sortedPosts = [...allPosts].sort((a, b) => {
  return a.publishedAt > b.publishedAt ? -1 : 1;
});
---

<BlogListLayout>
  <BlogListSortByCategoryButton client:load />
  <BlogList posts={sortedPosts} allPosts={allPosts} />
  <Pagination page={page} />
</BlogListLayout>
