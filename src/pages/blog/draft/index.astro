---
export const prerender = false;
import BlogDetailLayout from "@/layouts/BlogDetailLayout.astro";
import { attachCodeHighlight } from "@/libs/codeHighlight";
import { getArticleDraft, type Article } from "@/libs/microcms/blog";

const id = Astro.url.searchParams.get("id");
const draftKey = Astro.url.searchParams.get("draftKey");

if (!draftKey || !id) {
  Astro.response.status = 404;
}

let article: Article | null = null;
let highlightedArticle = "";
if (draftKey && id) {
  const fetched = await getArticleDraft(id, draftKey);
  article = fetched;
  highlightedArticle = attachCodeHighlight(fetched.content);
}
---
{article && (
  <BlogDetailLayout {...article}>
    <p set:html={highlightedArticle} />
    <!-- microCMSプレビュー用: id と draftKey をURLクエリに付与してアクセスしてください -->
  </BlogDetailLayout>
)}


