---
import BlogDetailLayout from "@/layouts/BlogDetailLayout.astro";
import { attachCodeHighlight } from "@/libs/codeHighlight";
import { attachLinkCards } from "@/libs/linkCard";
import { getArticles, type Article } from "@/libs/microcms/blog";
import TableOfContents from "@/components/TableOfContents.astro";

type Props = Article;

export async function getStaticPaths() {
  const res = await getArticles();
  const posts = res.contents;
  return posts.map((post) => {
    return {
      params: { slug: post.id },
      props: post,
    };
  });
}

const article = Astro.props;
let processedContent = attachCodeHighlight(article.content);
processedContent = await attachLinkCards(processedContent);
---

<BlogDetailLayout {...article}>
  <TableOfContents content={article.content} />
  <p set:html={processedContent} />
</BlogDetailLayout>
