---
import BlogDetailLayout from "@/layouts/BlogDetailLayout.astro";
import { attachCodeHighlight } from "@/libs/codeHighlight";
import { attachLinkCards } from "@/libs/linkCard";
import { attachHeadingIds } from "@/libs/headingIds";
import { getArticles, type Article } from "@/libs/microcms/blog";
import TableOfContents from "@/components/TableOfContents.astro";

type Props = Article;

export async function getStaticPaths() {
  const res = await getArticles();
  const posts = res.contents;
  return posts.map((post) => {
    return {
      params: { slug: post.id },
      props: post,
    };
  });
}

const article = Astro.props;
// 最初にH2タグにIDを付与
let processedContent = attachHeadingIds(article.content);
processedContent = attachCodeHighlight(processedContent);
processedContent = await attachLinkCards(processedContent);
---

<BlogDetailLayout {...article}>
  <!-- PC表示用の目次 -->
  <TableOfContents slot="toc-desktop" content={processedContent} />
  <!-- モバイル表示用の目次 -->
  <TableOfContents slot="toc-mobile" content={processedContent} />
  <p set:html={processedContent} />
</BlogDetailLayout>
