---
import { buildTocArray } from "@/features/Blog/functions/buildTocArray";
import BlogDetailLayout from "@/layouts/BlogDetailLayout.astro";
import { attachCodeHighlight } from "@/libs/codeHighlight";
import { getBlogs } from "@/libs/microcms/blog";

export async function getStaticPaths() {
  const res = await getBlogs();
  const posts = res.contents;
  return posts.map((post) => {
    return {
      params: { slug: post.id },
      props: post,
    };
  });
}

const post = Astro.props;
const { title, createdAt, publishedAt, updatedAt, description, eyecatch } =
  post;

const highlightedContent = attachCodeHighlight(post.content);

const input = highlightedContent;

const tocArray = buildTocArray(input);
---

<BlogDetailLayout
  title={title}
  description={description}
  pubDate={new Date(publishedAt)}
  heroImage={eyecatch.url}
  categories={post.category}
  {tocArray}
>
  <p set:html={highlightedContent} />
</BlogDetailLayout>
